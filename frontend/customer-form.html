<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>å®¢æˆ·ä¿¡æ¯æ”¶é›† - ä¿®èŒˆç§‘æŠ€è§†é¢‘å®šåˆ¶</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ“</text></svg>" />
  <link rel="stylesheet" href="./style.css" />
  <script src="https://unpkg.com/@phosphor-icons/web"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #1a1f2e 0%, #0d1117 100%);
      color: #e6edf3;
      min-height: 100vh;
      overflow: hidden;
    }

    .container {
      display: flex;
      height: 100vh;
      max-width: 1920px;
      margin: 0 auto;
    }

    /* å·¦ä¾§è¡¨å•åŒºåŸŸ */
    .form-section {
      flex: 1;
      padding: 24px 32px;
      overflow-y: auto;
      background: rgba(13, 17, 23, 0.8);
      border-right: 1px solid #30363d;
    }

    .form-header {
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 2px solid #58a6ff;
    }

    .form-header h1 {
      font-size: 24px;
      color: #58a6ff;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .form-header p {
      color: #8b949e;
      font-size: 14px;
      margin-top: 8px;
    }

    .form-group {
      margin-bottom: 24px;
      background: rgba(22, 27, 34, 0.6);
      padding: 20px;
      border-radius: 12px;
      border: 1px solid #30363d;
    }

    .form-group-title {
      font-size: 16px;
      color: #f0883e;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 600;
    }

    .form-row {
      margin-bottom: 16px;
    }

    .form-row:last-child {
      margin-bottom: 0;
    }

    .form-label {
      display: block;
      font-size: 14px;
      color: #c9d1d9;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .form-label .required {
      color: #f85149;
    }

    .form-input,
    .form-select,
    .form-textarea {
      width: 100%;
      padding: 10px 14px;
      background: #0d1117;
      border: 1px solid #30363d;
      border-radius: 8px;
      color: #e6edf3;
      font-size: 14px;
      transition: all 0.2s;
    }

    .form-input:focus,
    .form-select:focus,
    .form-textarea:focus {
      outline: none;
      border-color: #58a6ff;
      box-shadow: 0 0 0 3px rgba(88, 166, 255, 0.1);
    }

    .form-textarea {
      resize: vertical;
      min-height: 80px;
    }

    .checkbox-group {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }

    .checkbox-item {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 8px 12px;
      background: rgba(48, 54, 61, 0.5);
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .checkbox-item:hover {
      background: rgba(88, 166, 255, 0.2);
    }

    .checkbox-item input[type="checkbox"] {
      width: 16px;
      height: 16px;
      accent-color: #58a6ff;
    }

    .radio-group {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }

    .radio-item {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 8px 12px;
      background: rgba(48, 54, 61, 0.5);
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .radio-item:hover {
      background: rgba(88, 166, 255, 0.2);
    }

    .radio-item input[type="radio"] {
      width: 16px;
      height: 16px;
      accent-color: #58a6ff;
    }

    .highlight-field {
      border-left: 3px solid #f0883e;
      padding-left: 12px;
      margin-left: -12px;
    }

    .form-actions {
      display: flex;
      gap: 12px;
      margin-top: 32px;
      padding-top: 24px;
      border-top: 1px solid #30363d;
    }

    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.2s;
    }

    .btn-primary {
      background: linear-gradient(135deg, #238636 0%, #2ea043 100%);
      color: white;
    }

    .btn-primary:hover {
      background: linear-gradient(135deg, #2ea043 0%, #3fb950 100%);
    }

    .btn-secondary {
      background: #30363d;
      color: #c9d1d9;
    }

    .btn-secondary:hover {
      background: #3d444d;
    }

    /* å³ä¾§èŠå¤©åŒºåŸŸ */
    .chat-section {
      width: 420px;
      display: flex;
      flex-direction: column;
      background: rgba(22, 27, 34, 0.95);
      border-left: 1px solid #30363d;
    }

    .chat-header {
      padding: 16px 20px;
      background: linear-gradient(135deg, #f0883e 0%, #f6ad55 100%);
      border-bottom: 1px solid #30363d;
    }

    .chat-header h2 {
      font-size: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
      color: #fff;
    }

    .chat-header p {
      font-size: 12px;
      opacity: 0.9;
      margin-top: 4px;
      color: #fff;
    }

    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .message {
      max-width: 90%;
      padding: 12px 16px;
      border-radius: 12px;
      font-size: 14px;
      line-height: 1.6;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .message.ai {
      align-self: flex-start;
      background: rgba(240, 136, 62, 0.15);
      border: 1px solid rgba(240, 136, 62, 0.3);
      color: #c9d1d9;
    }

    .message.user {
      align-self: flex-end;
      background: linear-gradient(135deg, #238636 0%, #2ea043 100%);
      color: white;
    }

    .message-time {
      font-size: 11px;
      opacity: 0.7;
      margin-top: 6px;
    }

    .chat-input-area {
      padding: 16px 20px;
      border-top: 1px solid #30363d;
      background: rgba(13, 17, 23, 0.8);
    }

    .chat-input-wrapper {
      display: flex;
      gap: 10px;
      align-items: flex-end;
    }

    .chat-input {
      flex: 1;
      padding: 12px 16px;
      background: #0d1117;
      border: 1px solid #30363d;
      border-radius: 20px;
      color: #e6edf3;
      font-size: 14px;
      resize: none;
      min-height: 44px;
      max-height: 120px;
    }

    .chat-input:focus {
      outline: none;
      border-color: #f0883e;
    }

    .chat-send-btn {
      width: 44px;
      height: 44px;
      border: none;
      border-radius: 50%;
      background: linear-gradient(135deg, #f0883e 0%, #f6ad55 100%);
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    .chat-send-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 12px rgba(240, 136, 62, 0.4);
    }

    .chat-send-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .typing-indicator {
      display: flex;
      gap: 4px;
      padding: 12px 16px;
    }

    .typing-indicator span {
      width: 8px;
      height: 8px;
      background: #f0883e;
      border-radius: 50%;
      animation: typing 1.4s infinite;
    }

    .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
    .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }

    @keyframes typing {
      0%, 60%, 100% { transform: translateY(0); }
      30% { transform: translateY(-10px); }
    }

    /* æ»šåŠ¨æ¡æ ·å¼ */
    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: transparent;
    }

    ::-webkit-scrollbar-thumb {
      background: #30363d;
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #3d444d;
    }

    /* å­—æ®µæç¤º */
    .field-hint {
      font-size: 12px;
      color: #8b949e;
      margin-top: 4px;
    }

    /* å½“å‰æ­£åœ¨å¡«å†™çš„å­—æ®µé«˜äº® */
    .form-row.filling {
      background: rgba(240, 136, 62, 0.1);
      border-radius: 8px;
      padding: 12px;
      margin: -12px;
      border: 1px solid rgba(240, 136, 62, 0.3);
    }

    /* å·²å¡«å†™çš„å­—æ®µæ ‡è®° */
    .form-row.filled .form-label::after {
      content: 'âœ“';
      color: #2ea043;
      margin-left: 8px;
      font-weight: bold;
    }

    /* å“åº”å¼ */
    @media (max-width: 1200px) {
      .chat-section {
        width: 360px;
      }
    }

    @media (max-width: 900px) {
      .container {
        flex-direction: column;
      }
      .chat-section {
        width: 100%;
        height: 400px;
        border-left: none;
        border-top: 1px solid #30363d;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- å·¦ä¾§è¡¨å•åŒºåŸŸ -->
    <div class="form-section">
      <div class="form-header">
        <h1><i class="ph ph-clipboard-text"></i> ä¿®èŒˆç§‘æŠ€ Â· è§†é¢‘å®šåˆ¶èœå•</h1>
        <p>å°åˆ˜ä¼šå¸®æ‚¨å¡«å†™ï¼Œæ‚¨åªéœ€è¦åœ¨å³ä¾§å›ç­”ä»–çš„é—®é¢˜å³å¯</p>
      </div>

      <form id="customer-form">
        <!-- åŸºæœ¬ä¿¡æ¯ -->
        <div class="form-group">
          <div class="form-group-title"><i class="ph ph-info"></i> åŸºæœ¬ä¿¡æ¯</div>
          
          <div class="form-row" data-field="brand-name">
            <label class="form-label">
              <i class="ph ph-tag"></i> å“ç‰Œå <span class="required">*</span>
            </label>
            <input type="text" class="form-input" id="brand-name" placeholder="è¯·è¾“å…¥å“ç‰Œåç§°" required>
          </div>

          <div class="form-row" data-field="address">
            <label class="form-label">
              <i class="ph ph-map-pin"></i> åœ°å€
            </label>
            <input type="text" class="form-input" id="address" placeholder="è¯·è¾“å…¥åœ°å€">
          </div>

          <div class="form-row" data-field="account-info">
            <label class="form-label">
              <i class="ph ph-video"></i> è§†é¢‘è´¦å·åŸºæœ¬ä¿¡æ¯
            </label>
            <textarea class="form-textarea" id="account-info" placeholder="è¯·æè¿°æ‚¨çš„è§†é¢‘è´¦å·ç°çŠ¶ï¼Œå¦‚ï¼šç²‰ä¸æ•°ã€å†…å®¹ç±»å‹ã€è¿è¥æ—¶é—´ç­‰"></textarea>
          </div>
        </div>

        <!-- ç”¨æˆ·çš„è¡Œä¸šå’Œå®šä½ -->
        <div class="form-group">
          <div class="form-group-title"><i class="ph ph-target"></i> ç”¨æˆ·çš„è¡Œä¸šå’Œå®šä½</div>
          
          <div class="form-row" data-field="industry">
            <label class="form-label">
              <i class="ph ph-buildings"></i> è¡Œä¸šä¿¡æ¯ <span class="required">*</span>
            </label>
            <input type="text" class="form-input" id="industry" placeholder="ä¾‹å¦‚ï¼šé¤é¥®ã€æ•™è‚²ã€ç¾å¦†ã€ç§‘æŠ€ç­‰" required>
          </div>

          <div class="form-row" data-field="scale-plan">
            <label class="form-label">
              <i class="ph ph-chart-line-up"></i> è§„æ¨¡å¤§å°åŠæœªæ¥æ‰“ç®—
            </label>
            <textarea class="form-textarea" id="scale-plan" placeholder="è¯·æè¿°æ‚¨çš„ä¼ä¸šè§„æ¨¡å’Œå‘å±•è§„åˆ’"></textarea>
          </div>

          <div class="form-row highlight-field" data-field="user-requirements">
            <label class="form-label">
              <i class="ph ph-star"></i> ç”¨æˆ·è¦æ±‚ <span class="required">*</span>
            </label>
            <textarea class="form-textarea" id="user-requirements" placeholder="è¯·è¯¦ç»†æè¿°æ‚¨å¯¹è§†é¢‘çš„å…·ä½“è¦æ±‚å’ŒæœŸæœ›" required></textarea>
            <p class="field-hint">è¿™æ˜¯æœ€é‡è¦çš„ä¿¡æ¯ï¼Œè¯·å°½å¯èƒ½è¯¦ç»†æè¿°</p>
          </div>

          <div class="form-row" data-field="term">
            <label class="form-label">
              <i class="ph ph-calendar"></i> é•¿æœŸ/çŸ­æœŸ
            </label>
            <div class="radio-group">
              <label class="radio-item">
                <input type="radio" name="term" value="é•¿æœŸ" checked>
                <span>é•¿æœŸåˆä½œ</span>
              </label>
              <label class="radio-item">
                <input type="radio" name="term" value="çŸ­æœŸ">
                <span>çŸ­æœŸé¡¹ç›®</span>
              </label>
              <label class="radio-item">
                <input type="radio" name="term" value="æœªå®š">
                <span>æš‚æœªç¡®å®š</span>
              </label>
            </div>
          </div>
        </div>

        <!-- è§†é¢‘ç”¨é€” -->
        <div class="form-group">
          <div class="form-group-title"><i class="ph ph-film-strip"></i> è§†é¢‘ç”¨é€”ï¼ˆå¯å¤šé€‰ï¼‰</div>
          
          <div class="checkbox-group" data-field="video-purpose">
            <label class="checkbox-item">
              <input type="checkbox" name="video-purpose" value="å“ç‰Œå®£ä¼ æ¨å¹¿">
              <span>å“ç‰Œå®£ä¼ æ¨å¹¿</span>
            </label>
            <label class="checkbox-item">
              <input type="checkbox" name="video-purpose" value="äº§å“/æœåŠ¡æ¨é”€">
              <span>äº§å“/æœåŠ¡æ¨é”€</span>
            </label>
            <label class="checkbox-item">
              <input type="checkbox" name="video-purpose" value="ä¸ªäººIPæ‰“é€ ">
              <span>ä¸ªäººIPæ‰“é€ </span>
            </label>
            <label class="checkbox-item">
              <input type="checkbox" name="video-purpose" value="æ´»åŠ¨é¢„å‘Š">
              <span>æ´»åŠ¨é¢„å‘Š</span>
            </label>
            <label class="checkbox-item">
              <input type="checkbox" name="video-purpose" value="çŸ¥è¯†ç§‘æ™®åˆ†äº«">
              <span>çŸ¥è¯†ç§‘æ™®åˆ†äº«</span>
            </label>
          </div>
        </div>

        <!-- è§†é¢‘é¢„æœŸæ—¶é•¿ -->
        <div class="form-group">
          <div class="form-group-title"><i class="ph ph-clock"></i> è§†é¢‘é¢„æœŸæ—¶é•¿</div>
          
          <div class="radio-group" data-field="duration">
            <label class="radio-item">
              <input type="radio" name="duration" value="9-14ç§’">
              <span>9-14ç§’</span>
            </label>
            <label class="radio-item">
              <input type="radio" name="duration" value="16-22ç§’">
              <span>16-22ç§’</span>
            </label>
            <label class="radio-item">
              <input type="radio" name="duration" value="23-38ç§’">
              <span>23-38ç§’</span>
            </label>
            <label class="radio-item">
              <input type="radio" name="duration" value="38-46ç§’">
              <span>38-46ç§’</span>
            </label>
            <label class="radio-item">
              <input type="radio" name="duration" value="48-56ç§’">
              <span>48-56ç§’</span>
            </label>
            <label class="radio-item">
              <input type="radio" name="duration" value="1åˆ†é’Ÿä»¥ä¸Š">
              <span>1åˆ†é’Ÿä»¥ä¸Š</span>
            </label>
          </div>
        </div>

        <!-- è§†é¢‘åˆ›ä½œçš„åˆ›æ–°åº¦/çƒ­ç‚¹åº¦ -->
        <div class="form-group">
          <div class="form-group-title"><i class="ph ph-lightning"></i> è§†é¢‘åˆ›ä½œçš„åˆ›æ–°åº¦/çƒ­ç‚¹åº¦</div>
          
          <div class="radio-group" data-field="innovation">
            <label class="radio-item">
              <input type="radio" name="innovation" value="åŒè¡ŒæˆåŠŸæ¡ˆä¾‹å¤åˆ»ï¼ˆç¨³ï¼‰">
              <span>åŒè¡ŒæˆåŠŸæ¡ˆä¾‹å¤åˆ»ï¼ˆç¨³ï¼‰</span>
            </label>
            <label class="radio-item">
              <input type="radio" name="innovation" value="åŒè¡ŒæˆåŠŸæ¡ˆä¾‹å¤åˆ»ï¼ˆçƒ­ï¼‰">
              <span>åŒè¡ŒæˆåŠŸæ¡ˆä¾‹å¤åˆ»ï¼ˆçƒ­ï¼‰</span>
            </label>
            <label class="radio-item">
              <input type="radio" name="innovation" value="å®šåˆ¶åŒ–ï¼ˆç¨³ï¼‰">
              <span>å®šåˆ¶åŒ–ï¼ˆç¨³ï¼‰</span>
            </label>
            <label class="radio-item">
              <input type="radio" name="innovation" value="å®šåˆ¶åŒ–ï¼ˆçƒ­ï¼‰">
              <span>å®šåˆ¶åŒ–ï¼ˆçƒ­ï¼‰</span>
            </label>
          </div>
        </div>

        <!-- ç”¨æˆ·äººç¾¤/ç”»åƒ -->
        <div class="form-group">
          <div class="form-group-title"><i class="ph ph-users"></i> ç”¨æˆ·äººç¾¤/ç”»åƒ</div>
          
          <div class="form-row" data-field="target-audience">
            <label class="form-label">
              <i class="ph ph-user-focus"></i> æœåŠ¡äººç¾¤ä¸»è¦ç‰¹å¾
            </label>
            <input type="text" class="form-input" id="target-audience" placeholder="ä¾‹å¦‚ï¼š25-35å²å¥³æ€§ã€ä¸€çº¿åŸå¸‚ç™½é¢†ç­‰">
          </div>

          <div class="form-row" data-field="user-persona">
            <label class="form-label">
              <i class="ph ph-chart-pie"></i> è´¦å·ç”¨æˆ·ç”»åƒ
            </label>
            <textarea class="form-textarea" id="user-persona" placeholder="è¯·æè¿°æ‚¨çš„ç›®æ ‡ç”¨æˆ·ç”»åƒ"></textarea>
          </div>
        </div>

        <!-- è§†é¢‘çš„éœ€æ±‚å’Œè¿è¥è®¡åˆ’ -->
        <div class="form-group">
          <div class="form-group-title"><i class="ph ph-strategy"></i> è§†é¢‘çš„éœ€æ±‚å’Œè¿è¥è®¡åˆ’</div>
          
          <div class="form-row" data-field="budget">
            <label class="form-label">
              <i class="ph ph-currency-circle-dollar"></i> è§†é¢‘æŠ•å…¥æˆæœ¬æ¥å—ç¨‹åº¦
            </label>
            <select class="form-select" id="budget">
              <option value="">è¯·é€‰æ‹©é¢„ç®—èŒƒå›´</option>
              <option value="5000ä»¥ä¸‹">5000å…ƒä»¥ä¸‹</option>
              <option value="5000-10000">5000-10000å…ƒ</option>
              <option value="10000-30000">10000-30000å…ƒ</option>
              <option value="30000-50000">30000-50000å…ƒ</option>
              <option value="50000ä»¥ä¸Š">50000å…ƒä»¥ä¸Š</option>
              <option value="éœ€å•†è®®">éœ€å•†è®®</option>
            </select>
          </div>

          <div class="form-row" data-field="operation">
            <label class="form-label">
              <i class="ph ph-gear"></i> è¿è¥æ–¹æ¡ˆ
            </label>
            <div class="radio-group">
              <label class="radio-item">
                <input type="radio" name="operation" value="è‡ªå·±è¿è¥">
                <span>è‡ªå·±è¿è¥</span>
              </label>
              <label class="radio-item">
                <input type="radio" name="operation" value="ä¿®èŒˆç§‘æŠ€æä¾›">
                <span>ä¿®èŒˆç§‘æŠ€æä¾›</span>
              </label>
              <label class="radio-item">
                <input type="radio" name="operation" value="å…±åŒè¿è¥">
                <span>å…±åŒè¿è¥</span>
              </label>
            </div>
          </div>

          <div class="form-row highlight-field" data-field="highlights">
            <label class="form-label">
              <i class="ph ph-fire"></i> ç‰¹è‰²äº®ç‚¹ä»¥åŠè¯é¢˜çˆ†ç‚¹
            </label>
            <textarea class="form-textarea" id="highlights" placeholder="è¯·æè¿°æ‚¨å¸Œæœ›çªå‡ºçš„ç‰¹è‰²å’Œå¯èƒ½çš„è¯é¢˜çˆ†ç‚¹"></textarea>
          </div>

          <div class="form-row" data-field="platform-style">
            <label class="form-label">
              <i class="ph ph-device-mobile"></i> å¹³å°ä»¥åŠè§†é¢‘é£æ ¼
            </label>
            <input type="text" class="form-input" id="platform-style" placeholder="ä¾‹å¦‚ï¼šæŠ–éŸ³-æç¬‘é£æ ¼ã€å°çº¢ä¹¦-ç§è‰é£æ ¼ç­‰">
          </div>

          <div class="form-row" data-field="other">
            <label class="form-label">
              <i class="ph ph-notebook"></i> å…¶ä»–
            </label>
            <textarea class="form-textarea" id="other" placeholder="å…¶ä»–éœ€è¦è¡¥å……çš„ä¿¡æ¯"></textarea>
          </div>
        </div>

        <div class="form-actions">
          <button type="submit" class="btn btn-primary">
            <i class="ph ph-check-circle"></i> æäº¤ä¿¡æ¯
          </button>
          <button type="button" class="btn btn-secondary" id="save-draft">
            <i class="ph ph-floppy-disk"></i> ä¿å­˜è‰ç¨¿
          </button>
          <button type="button" class="btn btn-secondary" id="reset-form">
            <i class="ph ph-arrow-counter-clockwise"></i> é‡ç½®
          </button>
        </div>
      </form>
    </div>

    <!-- å³ä¾§èŠå¤©åŒºåŸŸ -->
    <div class="chat-section">
      <div class="chat-header">
        <h2><i class="ph ph-user-circle"></i> å°åˆ˜ - æ‚¨çš„ä¸“å±é¡¾é—®</h2>
        <p>æˆ‘ä¼šå¼•å¯¼æ‚¨å®Œæˆè¡¨å•å¡«å†™ï¼Œè¯·ç›´æ¥å›ç­”æˆ‘çš„é—®é¢˜</p>
        <div id="ai-model-badge" style="margin-top: 8px; font-size: 11px; opacity: 0.8; display: flex; align-items: center; gap: 6px;">
          <i class="ph ph-robot"></i>
          <span id="ai-model-name">æ­£åœ¨åŠ è½½AIé…ç½®...</span>
        </div>
        <div style="margin-top: 4px; font-size: 10px; opacity: 0.6; color: #f0883e;">
          <i class="ph ph-sparkle"></i> ä½¿ç”¨å®¢æˆ·å¯¹æ¥æ¨¡å— Â· æŠ–éŸ³ä»£è¿è¥æç¤ºè¯
        </div>
      </div>

      <div class="chat-messages" id="chat-messages">
        <!-- æ¶ˆæ¯ä¼šåŠ¨æ€æ·»åŠ åˆ°è¿™é‡Œ -->
      </div>

      <div class="chat-input-area">
        <!-- è¯­éŸ³æ§åˆ¶æŒ‰é’® -->
        <div class="voice-controls" style="display: flex; gap: 8px; margin-bottom: 10px; align-items: center;">
          <button class="voice-btn" id="voice-toggle" onclick="toggleVoice()" title="å¼€å¯/å…³é—­è¯­éŸ³æ’­æŠ¥">
            <i class="ph ph-speaker-high"></i>
            <span>è¯­éŸ³æ’­æŠ¥ï¼šå¼€</span>
          </button>
          <button class="voice-btn" id="voice-input-btn" onclick="toggleVoiceInput()" title="è¯­éŸ³è¾“å…¥">
            <i class="ph ph-microphone"></i>
            <span>è¯­éŸ³è¾“å…¥</span>
          </button>
          <span id="voice-status" style="font-size: 12px; color: #8b949e; margin-left: auto;"></span>
        </div>
        <div class="chat-input-wrapper">
          <textarea class="chat-input" id="chat-input" placeholder="è¾“å…¥æ‚¨çš„å›ç­”..." rows="1"></textarea>
          <button class="chat-send-btn" id="send-btn" onclick="sendMessage()">
            <i class="ph ph-paper-plane-right"></i>
          </button>
        </div>
      </div>
    </div>
  </div>

  <style>
    /* è¯­éŸ³æŒ‰é’®æ ·å¼ */
    .voice-btn {
      padding: 6px 12px;
      background: rgba(240, 136, 62, 0.1);
      border: 1px solid rgba(240, 136, 62, 0.3);
      border-radius: 16px;
      color: #f0883e;
      font-size: 12px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: all 0.2s;
    }
    .voice-btn:hover {
      background: rgba(240, 136, 62, 0.2);
    }
    .voice-btn.active {
      background: rgba(240, 136, 62, 0.3);
      border-color: #f0883e;
    }
    .voice-btn.recording {
      background: rgba(248, 81, 73, 0.2);
      border-color: #f85149;
      color: #f85149;
      animation: pulse 1.5s infinite;
    }
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.6; }
    }
    .voice-btn.recording i {
      animation: blink 1s infinite;
    }
    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.3; }
    }
  </style>

  <script>
    // ==================== å°åˆ˜è¯­éŸ³ç³»ç»Ÿ ====================
    
    // è¯­éŸ³æ’­æŠ¥åŠŸèƒ½ï¼šæ”¹ä¸ºè°ƒç”¨åç«¯ TTSï¼ˆGPT-SoVITSï¼‰ï¼Œè€Œä¸æ˜¯æµè§ˆå™¨è‡ªå¸¦ TTS
    let voiceEnabled = true;
    let currentAudio = null;
    
    // è¯­éŸ³è¯†åˆ«åŠŸèƒ½ (Web Speech API - ASR)
    let recognition = null;
    let isRecording = false;
    
    // åˆå§‹åŒ–è¯­éŸ³è¯†åˆ«
    function initSpeechRecognition() {
      if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        recognition = new SpeechRecognition();
        recognition.lang = 'zh-CN'; // ä¸­æ–‡è¯†åˆ«
        recognition.continuous = false;
        recognition.interimResults = false;
        
        recognition.onstart = function() {
          isRecording = true;
          updateVoiceInputUI();
          document.getElementById('voice-status').textContent = 'æ­£åœ¨è†å¬...';
        };
        
        recognition.onend = function() {
          isRecording = false;
          updateVoiceInputUI();
          document.getElementById('voice-status').textContent = '';
        };
        
        recognition.onresult = function(event) {
          const transcript = event.results[0][0].transcript;
          chatInput.value = transcript;
          chatInput.style.height = 'auto';
          chatInput.style.height = Math.min(chatInput.scrollHeight, 120) + 'px';
          // è‡ªåŠ¨å‘é€
          setTimeout(() => {
            sendMessage();
          }, 500);
        };
        
        recognition.onerror = function(event) {
          console.error('è¯­éŸ³è¯†åˆ«é”™è¯¯:', event.error);
          document.getElementById('voice-status').textContent = 'è¯†åˆ«å¤±è´¥ï¼Œè¯·é‡è¯•';
          isRecording = false;
          updateVoiceInputUI();
        };
        
        return true;
      } else {
        console.log('æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³è¯†åˆ«');
        document.getElementById('voice-status').textContent = 'æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³è¾“å…¥';
        return false;
      }
    }
    
    // åˆ‡æ¢è¯­éŸ³æ’­æŠ¥
    function toggleVoice() {
      voiceEnabled = !voiceEnabled;
      const btn = document.getElementById('voice-toggle');
      const icon = btn.querySelector('i');
      const text = btn.querySelector('span');
      
      if (voiceEnabled) {
        btn.classList.add('active');
        icon.className = 'ph ph-speaker-high';
        text.textContent = 'è¯­éŸ³æ’­æŠ¥ï¼šå¼€';
        // æµ‹è¯•è¯­éŸ³
        speak('è¯­éŸ³æ’­æŠ¥å·²å¼€å¯');
      } else {
        btn.classList.remove('active');
        icon.className = 'ph ph-speaker-slash';
        text.textContent = 'è¯­éŸ³æ’­æŠ¥ï¼šå…³';
        // åœæ­¢å½“å‰æ’­æ”¾
        if (currentAudio) {
          try {
            currentAudio.pause();
          } catch (e) {}
          currentAudio = null;
        }
      }
    }
    
    // åˆ‡æ¢è¯­éŸ³è¾“å…¥
    function toggleVoiceInput() {
      if (!recognition) {
        if (!initSpeechRecognition()) {
          alert('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³è¾“å…¥åŠŸèƒ½ï¼Œè¯·ä½¿ç”¨ Chrome æˆ– Edge æµè§ˆå™¨');
          return;
        }
      }
      
      if (isRecording) {
        recognition.stop();
      } else {
        try {
          recognition.start();
        } catch (e) {
          console.error('å¯åŠ¨è¯­éŸ³è¯†åˆ«å¤±è´¥:', e);
        }
      }
    }
    
    // æ›´æ–°è¯­éŸ³è¾“å…¥æŒ‰é’®çŠ¶æ€
    function updateVoiceInputUI() {
      const btn = document.getElementById('voice-input-btn');
      const icon = btn.querySelector('i');
      const text = btn.querySelector('span');
      
      if (isRecording) {
        btn.classList.add('recording');
        icon.className = 'ph ph-stop-circle';
        text.textContent = 'åœæ­¢å½•éŸ³';
      } else {
        btn.classList.remove('recording');
        icon.className = 'ph ph-microphone';
        text.textContent = 'è¯­éŸ³è¾“å…¥';
      }
    }
    
    // è¯­éŸ³æ’­æŠ¥å‡½æ•°ï¼šè°ƒç”¨åç«¯ /api/ttsï¼Œä½¿ç”¨ GPT-SoVITS ç”Ÿæˆè¯­éŸ³
    async function speak(text) {
      if (!voiceEnabled) return;
      if (!text || !text.trim()) return;

      // åœæ­¢ä¹‹å‰çš„éŸ³é¢‘
      if (currentAudio) {
        try {
          currentAudio.pause();
        } catch (e) {}
        currentAudio = null;
      }

      try {
        const resp = await fetch('http://localhost:8080/api/tts', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            text: text,
            lang: 'zh'
          })
        });

        const result = await resp.json();
        if (!resp.ok || result.success === false) {
          console.error('TTS è¯·æ±‚å¤±è´¥:', result && result.error && result.error.message ? result.error.message : resp.status);
          return;
        }

        const data = result.data || {};
        if (!data.audioBase64) {
          console.error('TTS è¿”å›ç¼ºå°‘ audioBase64 å­—æ®µ');
          return;
        }

        const audio = new Audio(data.audioBase64);
        currentAudio = audio;
        audio.play().catch((e) => {
          console.error('æ’­æ”¾ TTS éŸ³é¢‘å¤±è´¥:', e);
        });
      } catch (e) {
        console.error('è°ƒç”¨ TTS æ¥å£å‡ºé”™:', e);
      }
    }
    
    // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–è¯­éŸ³
    window.addEventListener('load', function() {
      // é¢„åŠ è½½è¯­éŸ³åˆ—è¡¨
      if (speechSynthesis) {
        // Chrome éœ€è¦ç­‰å¾… voiceschanged äº‹ä»¶
        if (speechSynthesis.onvoiceschanged !== undefined) {
          speechSynthesis.onvoiceschanged = function() {
            speechSynthesis.getVoices();
          };
        }
        speechSynthesis.getVoices();
      }
      // åˆå§‹åŒ–è¯­éŸ³è¯†åˆ«
      initSpeechRecognition();
      // è®¾ç½®è¯­éŸ³æŒ‰é’®åˆå§‹çŠ¶æ€
      document.getElementById('voice-toggle').classList.add('active');
    });
    
    // ==================== å°åˆ˜AIå¯¹è¯ç³»ç»Ÿ ====================
    
    const chatMessages = document.getElementById('chat-messages');
    const chatInput = document.getElementById('chat-input');
    
    // å®¢æˆ·å¯¹æ¥æ¨¡å—èŠ‚ç‚¹ID
    const CLIENT_MODULE_NODE_ID = 'douyin-client';
    
    // è·å–å®¢æˆ·å¯¹æ¥æ¨¡å—çš„AIé…ç½®
    function getAIConfig() {
      // é¦–å…ˆå°è¯•è·å–å®¢æˆ·å¯¹æ¥æ¨¡å—ä¸“å±çš„AIé…ç½®
      let orgNodeModels = {};
      let apiConfigs = {};
      
      try {
        const storedNodeModels = localStorage.getItem('orgNodeModels');
        orgNodeModels = storedNodeModels ? JSON.parse(storedNodeModels) : {};
        
        const storedApiConfigs = localStorage.getItem('aiApiConfigs');
        apiConfigs = storedApiConfigs ? JSON.parse(storedApiConfigs) : {};
      } catch (e) {
        console.log('è·å–AIé…ç½®å¤±è´¥:', e);
      }
      
      // æ£€æŸ¥å®¢æˆ·å¯¹æ¥æ¨¡å—æ˜¯å¦æœ‰ä¸“å±é…ç½®
      const clientModuleConfig = orgNodeModels[CLIENT_MODULE_NODE_ID];
      
      if (clientModuleConfig && clientModuleConfig.provider && clientModuleConfig.model) {
        // ä½¿ç”¨å®¢æˆ·å¯¹æ¥æ¨¡å—ä¸“å±çš„AIé…ç½®
        return {
          provider: clientModuleConfig.provider,
          model: clientModuleConfig.model,
          apiKey: apiConfigs[clientModuleConfig.provider] || '',
          isModuleSpecific: true
        };
      }
      
      // å¦‚æœæ²¡æœ‰ä¸“å±é…ç½®ï¼Œä½¿ç”¨å…¨å±€é»˜è®¤é…ç½®
      let selectedModel = localStorage.getItem('selectedModel') || 'qwen-max';
      let provider = 'qwen';
      let model = selectedModel;
      
      if (selectedModel && selectedModel.includes(':')) {
        [provider, model] = selectedModel.split(':');
      }
      
      return {
        provider,
        model,
        apiKey: apiConfigs[provider] || '',
        isModuleSpecific: false
      };
    }
    
    // æ˜¾ç¤ºå½“å‰AIé…ç½®
    function displayAIModelInfo() {
      const config = getAIConfig();
      const modelNameEl = document.getElementById('ai-model-name');
      
      if (modelNameEl) {
        if (config.isModuleSpecific) {
          modelNameEl.textContent = `å®¢æˆ·å¯¹æ¥æ¨¡å—ä¸“ç”¨: ${config.provider} Â· ${config.model}`;
          modelNameEl.style.color = '#f0883e';
        } else {
          modelNameEl.textContent = `ä½¿ç”¨å…¨å±€é…ç½®: ${config.provider} Â· ${config.model}`;
          modelNameEl.style.color = '#8b949e';
        }
      }
    }
    
    // è°ƒç”¨AIæ¨¡å‹ç”Ÿæˆå›å¤
    async function callAI(messages) {
      const config = getAIConfig();
      
      try {
        const response = await fetch('http://localhost:8080/api/chat', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            provider: config.provider,
            model: config.model,
            messages: messages,
            apiKey: config.apiKey,
            source: 'customer-form'
          })
        });
        
        const result = await response.json();
        if (!response.ok || result.success === false) {
          const msg = result && result.error && result.error.message ? result.error.message : 'AIè¯·æ±‚å¤±è´¥';
          throw new Error(msg);
        }
        
        const data = result.data || {};
        return data.content || data.message || 'æŠ±æ­‰ï¼Œæˆ‘æ²¡æœ‰ç†è§£ï¼Œè¯·å†è¯´ä¸€éã€‚';
      } catch (error) {
        console.error('AIè°ƒç”¨å¤±è´¥:', error);
        return null;
      }
    }
    
    // æ„å»ºç³»ç»Ÿæç¤ºè¯ - ä½¿ç”¨å®¢æˆ·å¯¹æ¥æ¨¡å—çš„æŠ–éŸ³ä»£è¿è¥æç¤ºè¯
    function buildSystemPrompt() {
      return `ä½ ç°åœ¨æ‰®æ¼”ä¸€åã€ŒæŠ–éŸ³ä»£è¿è¥ Â· 1äººå…¨èƒ½è´Ÿè´£äººã€å°åˆ˜ï¼Œä¸ºå®¢æˆ·æä¾›ä»éœ€æ±‚å¯¹æ¥åˆ°å†…å®¹å¤ç›˜çš„å…¨æµç¨‹æœåŠ¡ï¼Œè¯·ä¸¥æ ¼æŒ‰ç…§ä¸‹é¢çš„èŒè´£æ€è€ƒå’Œå›å¤ï¼š

ã€æ•´ä½“å®šä½ã€‘
- æ ¹æ®å®¢æˆ·è¡Œä¸šã€è´¦å·å®šä½ã€æŠ•æ”¾é¢„ç®—å’ŒæœåŠ¡å‘¨æœŸï¼Œç»™å‡ºé€‚é…çš„æŠ–éŸ³è¿è¥ç­–ç•¥ä¸æ‰§è¡Œæ–¹æ¡ˆã€‚
- æ—¢èƒ½åšå®¢æˆ·æ²Ÿé€šï¼Œåˆèƒ½ç‹¬ç«‹å®Œæˆå†…å®¹ç­–åˆ’ã€æ‹æ‘„è„šæœ¬ã€å‰ªè¾‘åŒ…è£…å’Œæ•°æ®å¤ç›˜ã€‚

ã€å½“å‰ä»»åŠ¡ - å®¢æˆ·å¯¹æ¥æ¨¡å—ã€‘
ä½ çš„é¦–è¦ä»»åŠ¡æ˜¯å¼•å¯¼å®¢æˆ·å¡«å†™è§†é¢‘å®šåˆ¶éœ€æ±‚è¡¨å•ï¼Œæ”¶é›†ä»¥ä¸‹ä¿¡æ¯ï¼š
1. å“ç‰Œåç§°
2. æ‰€åœ¨è¡Œä¸š
3. è§†é¢‘åˆ¶ä½œç›®çš„å’Œéœ€æ±‚ï¼ˆå“ç‰Œæ›å…‰/çº¿ç´¢è·å–/ç›´æ’­æˆäº¤ç­‰ï¼‰
4. è§†é¢‘ç”¨é€”ï¼ˆå“ç‰Œå®£ä¼ ã€äº§å“æ¨é”€ã€ä¸ªäººIPã€æ´»åŠ¨é¢„å‘Šã€çŸ¥è¯†ç§‘æ™®ï¼‰
5. è§†é¢‘æ—¶é•¿åå¥½ï¼ˆ9-14ç§’/16-22ç§’/23-38ç§’/38-46ç§’/48-56ç§’/1åˆ†é’Ÿä»¥ä¸Šï¼‰
6. ç›®æ ‡å®¢æˆ·ç¾¤ä½“ç”»åƒ
7. é¢„ç®—èŒƒå›´ï¼ˆ5000ä»¥ä¸‹/5000-10000/10000-30000/30000-50000/50000ä»¥ä¸Š/éœ€å•†è®®ï¼‰
8. å‘å¸ƒå¹³å°ï¼ˆæŠ–éŸ³/å°çº¢ä¹¦/Bç«™ç­‰ï¼‰å’Œè§†é¢‘é£æ ¼åå¥½
9. è¿è¥æ–¹æ¡ˆï¼ˆè‡ªå·±è¿è¥/ä¿®èŒˆç§‘æŠ€æä¾›/å…±åŒè¿è¥ï¼‰
10. äº§å“/æœåŠ¡ç‰¹è‰²äº®ç‚¹å’Œè¯é¢˜çˆ†ç‚¹

ã€å¯¹è¯è¦æ±‚ã€‘
- è¯­æ°”äº²åˆ‡ã€ä¸“ä¸šã€æœ‰è€å¿ƒï¼Œåƒä¸€ä½ç»éªŒä¸°å¯Œçš„é¡¾é—®
- æ¯æ¬¡åªé—®1-2ä¸ªé—®é¢˜ï¼Œç­‰å¾…å®¢æˆ·å›ç­”åå†ç»§ç»­
- æ ¹æ®å®¢æˆ·çš„è¡Œä¸šç‰¹ç‚¹ç»™å‡ºé’ˆå¯¹æ€§çš„å»ºè®®
- å¦‚æœå®¢æˆ·å›ç­”ä¸å¤Ÿæ¸…æ™°ï¼Œå‹å–„åœ°è¿½é—®
- é€‚å½“è§£é‡Šä¸ºä»€ä¹ˆéœ€è¦è¿™äº›ä¿¡æ¯
- ä¿æŒå¯¹è¯æµç•…è‡ªç„¶ï¼Œä¸è¦æœºæ¢°åœ°é€ä¸ªæé—®

ã€å›ç­”é£æ ¼ã€‘
- ç”¨ã€Œç¡®è®¤æ”¶åˆ° â†’ ç®€è¦å›åº” â†’ è‡ªç„¶è¿‡æ¸¡ â†’ ä¸‹ä¸€ä¸ªé—®é¢˜ã€çš„ç»“æ„
- å°½é‡ç»™å‡ºå…·ä½“çš„ä¾‹å­å¸®åŠ©å®¢æˆ·ç†è§£
- é€‚æ—¶ç»™äºˆä¸“ä¸šå»ºè®®ï¼Œå±•ç¤ºä½ çš„ä¸“ä¸šæ€§`;
    }
    
    // å¯¹è¯å†å²
    let conversationHistory = [
      { role: 'system', content: buildSystemPrompt() }
    ];
    
    // å®šä¹‰éœ€è¦æ”¶é›†çš„å­—æ®µä¿¡æ¯ï¼ˆç”¨äºè¡¨å•è‡ªåŠ¨å¡«å……ï¼‰
    const fieldMappings = {
      'brand-name': { name: 'å“ç‰Œåç§°', type: 'text' },
      'industry': { name: 'è¡Œä¸š', type: 'text' },
      'user-requirements': { name: 'è§†é¢‘éœ€æ±‚', type: 'text' },
      'video-purpose': { name: 'è§†é¢‘ç”¨é€”', type: 'checkbox', options: ['å“ç‰Œå®£ä¼ æ¨å¹¿', 'äº§å“/æœåŠ¡æ¨é”€', 'ä¸ªäººIPæ‰“é€ ', 'æ´»åŠ¨é¢„å‘Š', 'çŸ¥è¯†ç§‘æ™®åˆ†äº«'] },
      'duration': { name: 'è§†é¢‘æ—¶é•¿', type: 'radio', options: ['9-14ç§’', '16-22ç§’', '23-38ç§’', '38-46ç§’', '48-56ç§’', '1åˆ†é’Ÿä»¥ä¸Š'] },
      'target-audience': { name: 'ç›®æ ‡å®¢æˆ·', type: 'text' },
      'budget': { name: 'é¢„ç®—èŒƒå›´', type: 'select', options: ['5000ä»¥ä¸‹', '5000-10000', '10000-30000', '30000-50000', '50000ä»¥ä¸Š', 'éœ€å•†è®®'] },
      'platform-style': { name: 'å¹³å°å’Œé£æ ¼', type: 'text' },
      'operation': { name: 'è¿è¥æ–¹æ¡ˆ', type: 'radio', options: ['è‡ªå·±è¿è¥', 'ä¿®èŒˆç§‘æŠ€æä¾›', 'å…±åŒè¿è¥'] },
      'highlights': { name: 'ç‰¹è‰²äº®ç‚¹', type: 'text' }
    };
    
    // å½“å‰æ­£åœ¨æ”¶é›†çš„å­—æ®µ
    let currentField = null;
    let isCollecting = false;
    
    // åˆå§‹åŒ– - å°åˆ˜ä¸»åŠ¨æ‰“æ‹›å‘¼å¹¶å¼€å§‹æé—®ï¼ˆä½¿ç”¨AIï¼‰
    async function initXiaoLiu() {
      // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯åˆ°å†å²
      conversationHistory.push({
        role: 'user',
        content: 'è¯·å¼€å§‹å¯¹è¯ï¼Œå‘å®¢æˆ·æ‰“æ‹›å‘¼å¹¶è¯¢é—®å“ç‰Œåç§°ã€‚'
      });
      
      // æ˜¾ç¤ºæ­£åœ¨è¾“å…¥
      showTypingIndicator();
      
      // è°ƒç”¨AIç”Ÿæˆå›å¤
      const aiResponse = await callAI(conversationHistory);
      
      hideTypingIndicator();
      
      if (aiResponse) {
        // æ·»åŠ AIå›å¤åˆ°å†å²
        conversationHistory.push({
          role: 'assistant',
          content: aiResponse
        });
        
        // æ˜¾ç¤ºæ¶ˆæ¯
        addMessage(aiResponse, 'ai');
        
        // å°è¯•ä»AIå›å¤ä¸­æå–ä¿¡æ¯å¹¶å¡«å……è¡¨å•
        extractAndFillForm(aiResponse);
      } else {
        // AIè°ƒç”¨å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤é—®å€™
        const defaultGreeting = 'æ‚¨å¥½ï¼æˆ‘æ˜¯å°åˆ˜ï¼Œä¿®èŒˆç§‘æŠ€è§†é¢‘å®šåˆ¶çš„å®¢æˆ·é¡¾é—® ğŸ˜Š\n\nå¾ˆé«˜å…´ä¸ºæ‚¨æœåŠ¡ï¼è¯·é—®æ‚¨çš„å“ç‰Œåç§°æ˜¯ä»€ä¹ˆï¼Ÿ';
        addMessage(defaultGreeting, 'ai');
        conversationHistory.push({
          role: 'assistant',
          content: defaultGreeting
        });
      }
    }
    
    // ä»AIå›å¤ä¸­æå–ä¿¡æ¯å¹¶å¡«å……è¡¨å•
    function extractAndFillForm(aiText) {
      // è¿™é‡Œå¯ä»¥æ ¹æ®AIçš„å›å¤å†…å®¹æ™ºèƒ½è¯†åˆ«å¹¶å¡«å……è¡¨å•
      // ç®€åŒ–å¤„ç†ï¼šé«˜äº®ç¬¬ä¸€ä¸ªæœªå¡«å†™çš„å­—æ®µ
      const emptyFields = Object.keys(fieldMappings).filter(fieldId => {
        const field = document.getElementById(fieldId);
        return field && !field.value;
      });
      
      if (emptyFields.length > 0) {
        highlightField(emptyFields[0]);
      }
    }
    
    // é«˜äº®å­—æ®µ
    function highlightField(fieldId) {
      // ç§»é™¤æ‰€æœ‰é«˜äº®
      document.querySelectorAll('.form-row').forEach(row => {
        row.classList.remove('filling');
      });
      
      if (fieldId) {
        const row = document.querySelector(`[data-field="${fieldId}"]`);
        if (row) {
          row.classList.add('filling');
          row.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
      }
    }
    
    // æ»šåŠ¨åˆ°å­—æ®µ
    function scrollToField(fieldId) {
      const row = document.querySelector(`[data-field="${fieldId}"]`);
      if (row) {
        row.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }
    }
    
    // æ ‡è®°å­—æ®µå·²å¡«å†™
    function markFieldFilled(fieldId) {
      const row = document.querySelector(`[data-field="${fieldId}"]`);
      if (row) {
        row.classList.remove('filling');
        row.classList.add('filled');
      }
    }
    
    // å‘é€æ¶ˆæ¯
    async function sendMessage() {
      const message = chatInput.value.trim();
      if (!message) return;
      
      // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
      addMessage(message, 'user');
      chatInput.value = '';
      chatInput.style.height = 'auto';
      
      // å¤„ç†ç”¨æˆ·å›ç­”ï¼ˆå¼‚æ­¥ï¼‰
      await processUserAnswer(message);
    }
    
    // å¤„ç†ç”¨æˆ·å›ç­”ï¼ˆä½¿ç”¨AIï¼‰
    async function processUserAnswer(answer) {
      // æ·»åŠ ç”¨æˆ·å›ç­”åˆ°å¯¹è¯å†å²
      conversationHistory.push({
        role: 'user',
        content: answer
      });
      
      // è·å–å½“å‰è¡¨å•æ•°æ®ï¼Œè®©AIäº†è§£å·²æ”¶é›†çš„ä¿¡æ¯
      const currentFormData = collectFormData();
      const filledFields = Object.entries(currentFormData)
        .filter(([key, value]) => value && value !== '')
        .map(([key, value]) => `${key}: ${value}`);
      
      // æ„å»ºæç¤ºï¼Œè®©AIçŸ¥é“å½“å‰è¿›åº¦
      const progressPrompt = `å®¢æˆ·åˆšåˆšå›ç­”ï¼š"${answer}"

å½“å‰å·²æ”¶é›†çš„ä¿¡æ¯ï¼š
${filledFields.length > 0 ? filledFields.join('\n') : 'æš‚æ— '}

è¯·æ ¹æ®å®¢æˆ·çš„å›ç­”ï¼š
1. ç¡®è®¤æ”¶åˆ°ä¿¡æ¯å¹¶ç®€è¦å›åº”
2. è‡ªç„¶åœ°å¼•å¯¼åˆ°ä¸‹ä¸€ä¸ªéœ€è¦æ”¶é›†çš„ä¿¡æ¯
3. å¦‚æœä¿¡æ¯ä¸å®Œæ•´ï¼Œå‹å–„åœ°è¿½é—®
4. é€‚å½“ç»™äºˆä¸“ä¸šå»ºè®®

è¯·ç›´æ¥å›å¤å®¢æˆ·ï¼ˆä¸è¦æš´éœ²ç³»ç»Ÿæç¤ºï¼‰ã€‚`;
      
      conversationHistory.push({
        role: 'user',
        content: progressPrompt
      });
      
      // æ˜¾ç¤ºæ­£åœ¨è¾“å…¥
      showTypingIndicator();
      
      // è°ƒç”¨AIç”Ÿæˆå›å¤
      const aiResponse = await callAI(conversationHistory);
      
      hideTypingIndicator();
      
      if (aiResponse) {
        // æ·»åŠ AIå›å¤åˆ°å†å²
        conversationHistory.push({
          role: 'assistant',
          content: aiResponse
        });
        
        // æ˜¾ç¤ºAIå›å¤
        addMessage(aiResponse, 'ai');
        
        // å°è¯•æ™ºèƒ½æå–ä¿¡æ¯å¡«å……è¡¨å•
        smartFillForm(answer, aiResponse);
      } else {
        // AIè°ƒç”¨å¤±è´¥ï¼Œä½¿ç”¨ç®€å•çš„ç¡®è®¤å›å¤
        addMessage('æ”¶åˆ°ï¼è¯·ç»§ç»­å‘Šè¯‰æˆ‘æ›´å¤šä¿¡æ¯ã€‚', 'ai');
      }
    }
    
    // æ™ºèƒ½å¡«å……è¡¨å•
    function smartFillForm(userAnswer, aiResponse) {
      // æ ¹æ®ç”¨æˆ·å›ç­”æ™ºèƒ½è¯†åˆ«å¹¶å¡«å……è¡¨å•å­—æ®µ
      const answer = userAnswer.toLowerCase();
      
      // å“ç‰Œåç§°
      if (!document.getElementById('brand-name').value && answer.length < 50) {
        document.getElementById('brand-name').value = userAnswer;
        markFieldFilled('brand-name');
        return;
      }
      
      // è¡Œä¸š
      if (!document.getElementById('industry').value) {
        const industries = ['é¤é¥®', 'æ•™è‚²', 'ç¾å¦†', 'ç§‘æŠ€', 'ç”µå•†', 'æœè£…', 'æ—…æ¸¸', 'åŒ»ç–—', 'é‡‘è', 'æˆ¿åœ°äº§', 'æ±½è½¦', 'å¨±ä¹'];
        const found = industries.find(ind => answer.includes(ind));
        if (found) {
          document.getElementById('industry').value = found;
          markFieldFilled('industry');
          return;
        }
      }
      
      // è§†é¢‘éœ€æ±‚
      if (!document.getElementById('user-requirements').value && userAnswer.length > 10) {
        document.getElementById('user-requirements').value = userAnswer;
        markFieldFilled('user-requirements');
        return;
      }
      
      // ç›®æ ‡å®¢æˆ·
      if (!document.getElementById('target-audience').value) {
        document.getElementById('target-audience').value = userAnswer;
        markFieldFilled('target-audience');
        return;
      }
      
      // é¢„ç®—
      if (!document.getElementById('budget').value) {
        const budgetOptions = ['5000ä»¥ä¸‹', '5000-10000', '10000-30000', '30000-50000', '50000ä»¥ä¸Š', 'éœ€å•†è®®'];
        const found = budgetOptions.find(opt => answer.includes(opt.replace('å…ƒ', '').replace('ä»¥ä¸‹', '').replace('ä»¥ä¸Š', '')));
        if (found) {
          document.getElementById('budget').value = found;
          markFieldFilled('budget');
          return;
        }
      }
      
      // å¹³å°å’Œé£æ ¼
      if (!document.getElementById('platform-style').value) {
        document.getElementById('platform-style').value = userAnswer;
        markFieldFilled('platform-style');
        return;
      }
      
      // ç‰¹è‰²äº®ç‚¹
      if (!document.getElementById('highlights').value) {
        document.getElementById('highlights').value = userAnswer;
        markFieldFilled('highlights');
        return;
      }
      
      // é«˜äº®ä¸‹ä¸€ä¸ªç©ºå­—æ®µ
      const emptyFields = Object.keys(fieldMappings).filter(fieldId => {
        const field = document.getElementById(fieldId);
        return field && !field.value;
      });
      
      if (emptyFields.length > 0) {
        highlightField(emptyFields[0]);
      }
    }
    
    // å¡«å†™æ–‡æœ¬å­—æ®µ
    function fillTextField(fieldId, value) {
      const field = document.getElementById(fieldId);
      if (field) {
        field.value = value;
        return true;
      }
      return false;
    }
    
    // å¡«å†™å•é€‰å­—æ®µ
    function fillRadioField(fieldName, answer, options) {
      // å°è¯•ç›´æ¥åŒ¹é…é€‰é¡¹
      let matchedOption = options.find(opt => answer.includes(opt));
      
      // å¦‚æœæ²¡åŒ¹é…åˆ°ï¼Œå°è¯•æ•°å­—åŒ¹é…
      if (!matchedOption) {
        const numbers = answer.match(/\d+/g);
        if (numbers && numbers.length > 0) {
          const index = parseInt(numbers[0]) - 1;
          if (index >= 0 && index < options.length) {
            matchedOption = options[index];
          }
        }
      }
      
      if (matchedOption) {
        const radio = document.querySelector(`input[name="${fieldName}"][value="${matchedOption}"]`);
        if (radio) {
          radio.checked = true;
          return true;
        }
      }
      
      return false;
    }
    
    // å¡«å†™å¤šé€‰å­—æ®µ
    function fillCheckboxField(fieldName, answer, options) {
      const numbers = answer.match(/\d+/g);
      if (numbers && numbers.length > 0) {
        numbers.forEach(num => {
          const index = parseInt(num) - 1;
          if (index >= 0 && index < options.length) {
            const checkbox = document.querySelector(`input[name="${fieldName}"][value="${options[index]}"]`);
            if (checkbox) {
              checkbox.checked = true;
            }
          }
        });
        return true;
      }
      
      // å°è¯•ç›´æ¥åŒ¹é…é€‰é¡¹æ–‡æœ¬
      options.forEach(opt => {
        if (answer.includes(opt)) {
          const checkbox = document.querySelector(`input[name="${fieldName}"][value="${opt}"]`);
          if (checkbox) {
            checkbox.checked = true;
          }
        }
      });
      
      return true;
    }
    
    // å¡«å†™ä¸‹æ‹‰å­—æ®µ
    function fillSelectField(fieldId, answer, options) {
      const field = document.getElementById(fieldId);
      if (!field) return false;
      
      // å°è¯•ç›´æ¥åŒ¹é…
      let matched = options.find(opt => answer.includes(opt));
      
      if (matched) {
        field.value = matched;
        return true;
      }
      
      return false;
    }
    
    // æ·»åŠ æ¶ˆæ¯åˆ°èŠå¤©åŒº
    function addMessage(content, type) {
      const messageDiv = document.createElement('div');
      messageDiv.className = `message ${type}`;
      messageDiv.innerHTML = `
        <div style="white-space: pre-line;">${content}</div>
        <div class="message-time">${new Date().toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' })}</div>
      `;
      chatMessages.appendChild(messageDiv);
      chatMessages.scrollTop = chatMessages.scrollHeight;
      
      // å¦‚æœæ˜¯AIæ¶ˆæ¯ï¼Œè¿›è¡Œè¯­éŸ³æ’­æŠ¥
      if (type === 'ai') {
        // å»é™¤emojiå’Œç‰¹æ®Šç¬¦å·ï¼Œä¿ç•™çº¯æ–‡æœ¬ç”¨äºè¯­éŸ³æ’­æŠ¥
        const plainText = content
          .replace(/[ğŸ˜ŠğŸ‰âœ…ğŸ‘ğŸ’¡]/g, '')
          .replace(/\n/g, ' ')
          .replace(/\s+/g, ' ')
          .trim();
        speak(plainText);
      }
    }
    
    // æ˜¾ç¤ºæ­£åœ¨è¾“å…¥
    function showTypingIndicator() {
      const typingDiv = document.createElement('div');
      typingDiv.className = 'message ai typing';
      typingDiv.id = 'typing-indicator';
      typingDiv.innerHTML = `
        <div class="typing-indicator">
          <span></span>
          <span></span>
          <span></span>
        </div>
      `;
      chatMessages.appendChild(typingDiv);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }
    
    // éšè—æ­£åœ¨è¾“å…¥
    function hideTypingIndicator() {
      const typingIndicator = document.getElementById('typing-indicator');
      if (typingIndicator) {
        typingIndicator.remove();
      }
    }
    
    // è‡ªåŠ¨è°ƒæ•´è¾“å…¥æ¡†é«˜åº¦
    chatInput.addEventListener('input', function() {
      this.style.height = 'auto';
      this.style.height = Math.min(this.scrollHeight, 120) + 'px';
    });
    
    // å›è½¦å‘é€
    chatInput.addEventListener('keydown', function(e) {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });
    
    // ==================== è¡¨å•åŠŸèƒ½ ====================
    
    // è¡¨å•æäº¤
    document.getElementById('customer-form').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const formData = collectFormData();
      console.log('è¡¨å•æ•°æ®ï¼š', formData);
      
      // æäº¤åˆ°åç«¯API
      try {
        const submitBtn = document.querySelector('button[type="submit"]');
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<i class="ph ph-spinner ph-spin"></i> æäº¤ä¸­...';
        
        const response = await fetch('/api/customers', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(formData)
        });
        
        const result = await response.json();
        if (response.ok && result && result.success !== false) {
          console.log('æäº¤æˆåŠŸ:', result);
          
          // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
          addMessage('ğŸ‰ ä¿¡æ¯æäº¤æˆåŠŸï¼\n\næ„Ÿè°¢æ‚¨çš„é…åˆï¼Œæˆ‘ä»¬çš„å›¢é˜Ÿä¼šå°½å¿«å®¡æ ¸æ‚¨çš„éœ€æ±‚å¹¶ä¸æ‚¨è”ç³»ã€‚å¦‚æœæœ‰ç´§æ€¥é—®é¢˜ï¼Œå¯ä»¥éšæ—¶æ‰¾æˆ‘ï¼', 'ai');
          
          // æ¸…ç©ºè‰ç¨¿
          localStorage.removeItem('customerFormDraft');
          
          alert('ä¿¡æ¯å·²æäº¤ï¼æˆ‘ä»¬ä¼šå°½å¿«ä¸æ‚¨è”ç³»ã€‚');
          
          // å¯é€‰ï¼šæäº¤åè·³è½¬åˆ°æˆåŠŸé¡µé¢æˆ–æ¸…ç©ºè¡¨å•
          // document.getElementById('customer-form').reset();
        } else {
          const msg = result && result.error && result.error.message ? result.error.message : 'æäº¤å¤±è´¥';
          throw new Error(msg);
        }
      } catch (error) {
        console.error('æäº¤å¤±è´¥:', error);
        addMessage('âŒ æäº¤å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•æˆ–è”ç³»å®¢æœã€‚é”™è¯¯ï¼š' + error.message, 'ai');
        alert('æäº¤å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
      } finally {
        const submitBtn = document.querySelector('button[type="submit"]');
        submitBtn.disabled = false;
        submitBtn.innerHTML = '<i class="ph ph-paper-plane-right"></i> æäº¤ä¿¡æ¯';
      }
    });
    
    // æ”¶é›†è¡¨å•æ•°æ®
    function collectFormData() {
      const data = {
        brandName: document.getElementById('brand-name').value,
        address: document.getElementById('address').value,
        accountInfo: document.getElementById('account-info').value,
        industry: document.getElementById('industry').value,
        scalePlan: document.getElementById('scale-plan').value,
        userRequirements: document.getElementById('user-requirements').value,
        term: document.querySelector('input[name="term"]:checked')?.value,
        videoPurpose: Array.from(document.querySelectorAll('input[name="video-purpose"]:checked')).map(cb => cb.value),
        duration: document.querySelector('input[name="duration"]:checked')?.value,
        innovation: document.querySelector('input[name="innovation"]:checked')?.value,
        targetAudience: document.getElementById('target-audience').value,
        userPersona: document.getElementById('user-persona').value,
        budget: document.getElementById('budget').value,
        operation: document.querySelector('input[name="operation"]:checked')?.value,
        highlights: document.getElementById('highlights').value,
        platformStyle: document.getElementById('platform-style').value,
        other: document.getElementById('other').value
      };
      return data;
    }
    
    // ä¿å­˜è‰ç¨¿
    document.getElementById('save-draft').addEventListener('click', function() {
      const data = collectFormData();
      localStorage.setItem('customerFormDraft', JSON.stringify(data));
      addMessage('âœ… è‰ç¨¿å·²ä¿å­˜åˆ°æœ¬åœ°', 'ai');
    });
    
    // é‡ç½®è¡¨å•
    document.getElementById('reset-form').addEventListener('click', function() {
      if (confirm('ç¡®å®šè¦é‡ç½®è¡¨å•å—ï¼Ÿå·²å¡«å†™çš„æ•°æ®å°†æ¸…ç©ºã€‚')) {
        document.getElementById('customer-form').reset();
        document.querySelectorAll('.form-row').forEach(row => {
          row.classList.remove('filled', 'filling');
        });
        currentQuestionIndex = 0;
        addMessage('è¡¨å•å·²é‡ç½®ï¼Œæˆ‘ä»¬é‡æ–°å¼€å§‹å§ï¼ğŸ˜Š', 'ai');
        setTimeout(() => {
          askQuestion(0);
        }, 1000);
      }
    });
    
    // åŠ è½½è‰ç¨¿
    function loadDraft() {
      const draft = localStorage.getItem('customerFormDraft');
      if (draft) {
        const data = JSON.parse(draft);
        // æ¢å¤æ•°æ®åˆ°è¡¨å•
        if (data.brandName) document.getElementById('brand-name').value = data.brandName;
        if (data.address) document.getElementById('address').value = data.address;
        if (data.accountInfo) document.getElementById('account-info').value = data.accountInfo;
        if (data.industry) document.getElementById('industry').value = data.industry;
        if (data.scalePlan) document.getElementById('scale-plan').value = data.scalePlan;
        if (data.userRequirements) document.getElementById('user-requirements').value = data.userRequirements;
        if (data.targetAudience) document.getElementById('target-audience').value = data.targetAudience;
        if (data.userPersona) document.getElementById('user-persona').value = data.userPersona;
        if (data.budget) document.getElementById('budget').value = data.budget;
        if (data.highlights) document.getElementById('highlights').value = data.highlights;
        if (data.platformStyle) document.getElementById('platform-style').value = data.platformStyle;
        if (data.other) document.getElementById('other').value = data.other;
        
        // æ¢å¤å•é€‰æŒ‰é’®
        if (data.term) {
          const termRadio = document.querySelector(`input[name="term"][value="${data.term}"]`);
          if (termRadio) termRadio.checked = true;
        }
        if (data.duration) {
          const durationRadio = document.querySelector(`input[name="duration"][value="${data.duration}"]`);
          if (durationRadio) durationRadio.checked = true;
        }
        if (data.innovation) {
          const innovationRadio = document.querySelector(`input[name="innovation"][value="${data.innovation}"]`);
          if (innovationRadio) innovationRadio.checked = true;
        }
        if (data.operation) {
          const operationRadio = document.querySelector(`input[name="operation"][value="${data.operation}"]`);
          if (operationRadio) operationRadio.checked = true;
        }
        
        // æ¢å¤å¤é€‰æ¡†
        if (data.videoPurpose) {
          data.videoPurpose.forEach(value => {
            const checkbox = document.querySelector(`input[name="video-purpose"][value="${value}"]`);
            if (checkbox) checkbox.checked = true;
          });
        }
        
        // æ ‡è®°å·²å¡«å†™çš„å­—æ®µ
        document.querySelectorAll('.form-row').forEach(row => {
          const fieldId = row.dataset.field;
          if (fieldId) {
            const field = document.getElementById(fieldId);
            if (field && field.value) {
              row.classList.add('filled');
            }
          }
        });
        
        addMessage('æ£€æµ‹åˆ°æ‚¨æœ‰æœªå®Œæˆçš„è‰ç¨¿ï¼Œå·²å¸®æ‚¨æ¢å¤ã€‚æˆ‘ä»¬ç»§ç»­å§ï¼ğŸ˜Š', 'ai');
        
        // æ‰¾åˆ°ç¬¬ä¸€ä¸ªæœªå¡«å†™çš„å­—æ®µç»§ç»­æé—®
        for (let i = 0; i < questions.length; i++) {
          const field = document.getElementById(questions[i].field);
          if (!field || !field.value) {
            currentQuestionIndex = i - 1;
            setTimeout(() => {
              askQuestion(i);
            }, 1500);
            return;
          }
        }
        
        // å¦‚æœéƒ½å¡«å†™äº†
        currentQuestionIndex = questions.length;
        setTimeout(() => {
          addMessage('çœ‹èµ·æ¥æ‚¨å·²ç»å¡«å†™å®Œæ‰€æœ‰ä¿¡æ¯äº†ï¼è¯·æ£€æŸ¥ä¸€ä¸‹å·¦ä¾§è¡¨å•ï¼Œç¡®è®¤æ— è¯¯åå°±å¯ä»¥æäº¤å•¦~ ğŸ‰', 'ai');
        }, 1500);
      } else {
        // æ²¡æœ‰è‰ç¨¿æ—¶ï¼Œæ ¹æ®æ˜¯å¦æœ‰AIé…ç½®å†³å®šæ˜¯å¦è‡ªåŠ¨å¼€å§‹å¯¹è¯
        if (hasAIConfig()) {
          initXiaoLiu();
        } else {
          addMessage('ğŸ¤– æ‚¨å¥½ï¼æˆ‘æ˜¯å°åˆ˜ï¼Œä¿®èŒˆç§‘æŠ€çš„å®¢æˆ·é¡¾é—®ã€‚\n\nè¯·å…ˆåœ¨ç»„ç»‡æ¶æ„ä¸­ä¸ºå®¢æˆ·å¯¹æ¥æ¨¡å—æ¥å…¥AIæ¨¡å‹ï¼Œç„¶åæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹æ”¶é›†å®¢æˆ·ä¿¡æ¯å•¦ï¼', 'ai');
        }
      }
    }

    // æ£€æŸ¥æ˜¯å¦æœ‰å¯ç”¨çš„ AI é…ç½®
    function hasAIConfig() {
      const config = getAIConfig();
      return config.provider && config.model;
    }
    
    // é¡µé¢åŠ è½½æ—¶
    window.addEventListener('load', function() {
      // æ˜¾ç¤ºå½“å‰AIé…ç½®
      displayAIModelInfo();
      // åŠ è½½è‰ç¨¿æˆ–å¼€å§‹æ–°å¯¹è¯
      loadDraft();
    });
  </script>
</body>
</html>
